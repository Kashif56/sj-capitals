{% extends 'common/auth_base.html' %}
{% block title %}Register{% endblock %}

{% block auth_left_content %}
<h2>Join SJ Capitals</h2>
<p>Create your account today and start your investment journey with us. Enjoy exclusive benefits and personalized investment opportunities.</p>
<ul class="auth-features">
  <li><i class="bi bi-rocket-takeoff"></i> Quick account setup</li>
  <li><i class="bi bi-gem"></i> Access to premium investments</li>
  <li><i class="bi bi-piggy-bank"></i> Low minimum deposit</li>
  <li><i class="bi bi-shield-lock"></i> Bank-level security</li>
</ul>

<style>
  @media (max-width: 767px) {
    .auth-features li {
      margin-bottom: 0.75rem;
    }
    .auth-left h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    .auth-left p {
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
  }
</style>
{% endblock %}

{% block content %}
          <h3 class="mb-3 mb-md-4 fw-bold">Create Your Account</h3>
          
          <!-- Progress Bar -->
          <div class="mb-3 mb-md-4">
            <div class="d-flex justify-content-between mb-1">
              <span class="step-text step-1-text fw-bold">Account Details</span>
              <span class="step-text step-2-text text-muted">Personal Information</span>
            </div>
            <div class="progress" style="height: 8px;">
              <div class="progress-bar bg-success" role="progressbar" style="width: 50%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
          
          <form method="post" id="registerForm" novalidate>
            {% csrf_token %}
            <!-- Step 1: Account Details -->
            <div id="step1" class="step-content">
              <div class="mb-3">
                <label for="registerUsername" class="form-label">Username</label>
                <div class="input-group mb-1">
                  <span class="input-group-text bg-light border-end-0"><i class="bi bi-person"></i></span>
                  <input type="text" class="form-control border-start-0" id="registerUsername" name="username" placeholder="johndoe" required minlength="3">
                </div>
                <div class="invalid-feedback">Please enter a username (at least 3 characters).</div>
              </div>
              <div class="mb-3">
                <label for="registerEmail" class="form-label">Email address</label>
                <div class="input-group mb-1">
                  <span class="input-group-text bg-light border-end-0"><i class="bi bi-envelope"></i></span>
                  <input type="email" class="form-control border-start-0" id="registerEmail" name="email" placeholder="name@example.com" required>
                </div>
                <div class="invalid-feedback">Please enter a valid email.</div>
              </div>
              <div class="mb-3">
                <label for="registerPassword" class="form-label">Password</label>
                <div class="input-group mb-1">
                  <span class="input-group-text bg-light border-end-0"><i class="bi bi-lock"></i></span>
                  <input type="password" class="form-control border-start-0" id="registerPassword" name="password" placeholder="••••••" required minlength="6">
                </div>
                <div class="invalid-feedback">Password must be at least 6 characters.</div>
              </div>
              <div class="mb-3 mb-md-4">
                <label for="registerPassword2" class="form-label">Confirm Password</label>
                <div class="input-group mb-1">
                  <span class="input-group-text bg-light border-end-0"><i class="bi bi-lock-fill"></i></span>
                  <input type="password" class="form-control border-start-0" id="registerPassword2" name="password2" placeholder="••••••" required minlength="6">
                </div>
                <div class="invalid-feedback">Passwords must match.</div>
              </div>
              <button type="button" id="nextBtn" class="btn btn-success w-100 py-2 py-md-3 fw-bold">Continue</button>
            </div>
            
            <!-- Step 2: Personal Information -->
            <div id="step2" class="step-content" style="display: none;">
              <div class="mb-3">
                <label for="registerName" class="form-label">Full Name</label>
                <div class="input-group mb-1">
                  <span class="input-group-text bg-light border-end-0"><i class="bi bi-person-vcard"></i></span>
                  <input type="text" class="form-control border-start-0" id="registerName" name="name" placeholder="John Doe" required>
                </div>
                <div class="invalid-feedback">Please enter your full name.</div>
              </div>
              <div class="mb-3">
                <label for="registerAddress" class="form-label">Address</label>
                <div class="input-group mb-1">
                  <span class="input-group-text bg-light border-end-0"><i class="bi bi-geo-alt"></i></span>
                  <input type="text" class="form-control border-start-0" id="registerAddress" name="address" placeholder="123 Main St, City" required>
                </div>
                <div class="invalid-feedback">Please enter your address.</div>
              </div>
              <div class="mb-3 mb-md-4">
                <label for="registerPhone" class="form-label">Phone Number</label>
                <div class="input-group mb-1">
                  <span class="input-group-text bg-light border-end-0"><i class="bi bi-telephone"></i></span>
                  <input type="tel" class="form-control border-start-0" id="registerPhone" name="phone" placeholder="+1 (555) 123-4567" required>
                </div>
                <div class="invalid-feedback">Please enter your phone number.</div>
              </div>
              <div class="d-flex justify-content-between">
                <button type="button" id="prevBtn" class="btn btn-outline-secondary py-2 py-md-3 fw-bold" style="width: 25%;"><i class="bi bi-arrow-left"></i></button>
                <button type="submit" class="btn btn-success py-2 py-md-3 fw-bold" style="width: 70%;">Create Account</button>
              </div>
            </div>
          </form>
          <div class="mt-3 mt-md-4 text-center">
            <span class="text-muted">Already have an account? <a href="/accounts/login/" class="text-success fw-bold">Sign In</a></span>
          </div>
          
          <style>
            .step-text {
              font-size: 0.85rem;
              transition: all 0.3s ease;
            }
            
            @media (min-width: 768px) {
              .step-text {
                font-size: 0.9rem;
              }
            }
            
            .progress {
              border-radius: 4px;
              background-color: #f0f0f0;
            }
            
            @media (max-width: 767px) {
              .form-control, .input-group-text {
                padding: 0.6rem 0.75rem;
              }
              .form-label {
                margin-bottom: 0.3rem;
                font-size: 0.9rem;
              }
              h3.fw-bold {
                font-size: 1.5rem;
              }
            }
          </style>
          
          <script>
            document.addEventListener('DOMContentLoaded', function() {
              const step1 = document.getElementById('step1');
              const step2 = document.getElementById('step2');
              const nextBtn = document.getElementById('nextBtn');
              const prevBtn = document.getElementById('prevBtn');
              const step1Text = document.querySelector('.step-1-text');
              const step2Text = document.querySelector('.step-2-text');
              const progressBar = document.querySelector('.progress-bar');
              const form = document.getElementById('registerForm');
              
              // Validate password match
              function validatePasswords() {
                const pw1 = document.getElementById('registerPassword');
                const pw2 = document.getElementById('registerPassword2');
                if(pw1.value !== pw2.value) {
                  pw2.setCustomValidity('Passwords must match.');
                  return false;
                } else {
                  pw2.setCustomValidity('');
                  return true;
                }
              }
              
              // Validate step 1 fields
              function validateStep1() {
                const username = document.getElementById('registerUsername');
                const email = document.getElementById('registerEmail');
                const pw1 = document.getElementById('registerPassword');
                const pw2 = document.getElementById('registerPassword2');
                
                let isValid = true;
                
                if (!username.value || username.value.length < 3) {
                  username.classList.add('is-invalid');
                  isValid = false;
                } else {
                  username.classList.remove('is-invalid');
                }
                
                if (!email.value || !email.value.includes('@')) {
                  email.classList.add('is-invalid');
                  isValid = false;
                } else {
                  email.classList.remove('is-invalid');
                }
                
                if (!pw1.value || pw1.value.length < 6) {
                  pw1.classList.add('is-invalid');
                  isValid = false;
                } else {
                  pw1.classList.remove('is-invalid');
                }
                
                if (!validatePasswords()) {
                  pw2.classList.add('is-invalid');
                  isValid = false;
                } else {
                  pw2.classList.remove('is-invalid');
                }
                
                return isValid;
              }
              
              // Next button click handler
              nextBtn.addEventListener('click', function() {
                if (validateStep1()) {
                  step1.style.display = 'none';
                  step2.style.display = 'block';
                  step1Text.classList.remove('fw-bold');
                  step1Text.classList.add('text-muted');
                  step2Text.classList.remove('text-muted');
                  step2Text.classList.add('fw-bold');
                  progressBar.style.width = '100%';
                }
              });
              
              // Previous button click handler
              prevBtn.addEventListener('click', function() {
                step2.style.display = 'none';
                step1.style.display = 'block';
                step2Text.classList.remove('fw-bold');
                step2Text.classList.add('text-muted');
                step1Text.classList.remove('text-muted');
                step1Text.classList.add('fw-bold');
                progressBar.style.width = '50%';
              });
              
              // Form submission handler
              form.addEventListener('submit', function(e) {
                const name = document.getElementById('registerName');
                const address = document.getElementById('registerAddress');
                const phone = document.getElementById('registerPhone');
                
                let isValid = true;
                
                if (!name.value || name.value.length < 2) {
                  name.classList.add('is-invalid');
                  isValid = false;
                } else {
                  name.classList.remove('is-invalid');
                }
                
                if (!address.value) {
                  address.classList.add('is-invalid');
                  isValid = false;
                } else {
                  address.classList.remove('is-invalid');
                }
                
                if (!phone.value) {
                  phone.classList.add('is-invalid');
                  isValid = false;
                } else {
                  phone.classList.remove('is-invalid');
                }
                
                if (!isValid) {
                  e.preventDefault();
                }
              });
            });
          </script>

{% endblock %}
{% block extra_js %}
<script>
// Password match validation
const form = document.querySelector('form');
if(form) {
  form.addEventListener('submit', function(e) {
    const pw1 = document.getElementById('registerPassword');
    const pw2 = document.getElementById('registerPassword2');
    if(pw1.value !== pw2.value) {
      pw2.setCustomValidity('Passwords must match.');
      pw2.reportValidity();
      e.preventDefault();
    } else {
      pw2.setCustomValidity('');
    }
  });
}
</script>
{% endblock %}
